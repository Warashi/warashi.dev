<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>Go Commits in this Week at 2022-04-30</title>
<meta name=description content="https://github.com/golang/go に今週あったコミットのうち、僕の目にとまったもをの書いていきます。
slices: use !{{Less}} instead of {{GreaterOrEqual}} sortで a と b を比較する際に a >= b を使うか !(a < …"><meta name=keywords content='Go'><meta property="og:url" content="https://warashi.dev/posts/f04043e4-a05b-4f5f-90a2-fe05e6f8e395/"><meta property="og:type" content="website"><meta property="og:title" content="Go Commits in this Week at 2022-04-30"><meta property="og:description" content="https://github.com/golang/go に今週あったコミットのうち、僕の目にとまったもをの書いていきます。
slices: use !{{Less}} instead of {{GreaterOrEqual}} sortで a と b を比較する際に a >= b を使うか !(a < …"><meta property="og:image" content="https://warashi.dev/images/tisza.png"><meta property="og:image:secure_url" content="https://warashi.dev/images/tisza.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Go Commits in this Week at 2022-04-30"><meta name=twitter:description content="https://github.com/golang/go に今週あったコミットのうち、僕の目にとまったもをの書いていきます。
slices: use !{{Less}} instead of {{GreaterOrEqual}} sortで a と b を比較する際に a >= b を使うか !(a < …"><meta property="twitter:domain" content="https://warashi.dev/posts/f04043e4-a05b-4f5f-90a2-fe05e6f8e395/"><meta property="twitter:url" content="https://warashi.dev/posts/f04043e4-a05b-4f5f-90a2-fe05e6f8e395/"><meta name=twitter:image content="https://warashi.dev/images/tisza.png"><link rel=canonical href=https://warashi.dev/posts/f04043e4-a05b-4f5f-90a2-fe05e6f8e395/><link rel=stylesheet type=text/css href=https://warashi.dev/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=https://warashi.dev/css/main.min.css><link id=dark-theme rel=stylesheet href=https://warashi.dev/css/dark.min.css><script src=https://warashi.dev/js/bundle.min.a036ebe92c17ea3f0c07761c2135b82bec6f37c8efb7f49ddad1f28c22fc4769.js integrity="sha256-oDbr6SwX6j8MB3YcITW4K+xvN8jvt/Sd2tHyjCL8R2k="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://warashi.dev/><img src=https://warashi.dev/images/tisza.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://warashi.dev/>404 やる気 Not Found</a></div><div class=nav-links><div class=nav-link><a href=https://warashi.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://warashi.dev/about/ aria-label><span data-feather=smile></span> About</a></div><div class=nav-link><a href=https://warashi.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://times.warashi.dev/ aria-label><span data-feather=hash></span> times-warashi</a></div><div class=nav-link><a href=https://warashi.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://warashi.dev/index.xml aria-label><span data-feather=rss></span> Feed</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://warashi.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://warashi.dev/about/><span data-feather=smile></span> About</a></li><li class=nav-item><a href=https://warashi.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://times.warashi.dev/><span data-feather=hash></span> times-warashi</a></li><li class=nav-item><a href=https://warashi.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://warashi.dev/index.xml><span data-feather=rss></span> Feed</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Go Commits in this Week at 2022-04-30</h1><small role=doc-subtitle></small><p class=post-date>2022-04-30</p><ul class=post-tags><li class=post-tag><a href=https://warashi.dev/tags/go>Go</a></li></ul></div><div class=post-content><p><a href=https://github.com/golang/go>https://github.com/golang/go</a> に今週あったコミットのうち、僕の目にとまったもをの書いていきます。</p><h2 id=slices-use-less-instead-of-greaterorequal><a href=https://github.com/golang/go/commit/415e3fd8a6e62d7e9cf7d0c995518179dc0b7723>slices: use !{{Less}} instead of {{GreaterOrEqual}}</a></h2><p>sortで <code>a</code> と <code>b</code> を比較する際に <code>a >= b</code> を使うか <code>!(a &lt; b)</code> を使うかによって結果が変わってしまうから元に戻すよ、ということのようです。この2つは一見同じように見えるのですが、浮動小数点数で <code>NaN</code> が混じっているときに同じ結果ではなくなります。</p><div class=highlight><div style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81c8be>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81c8be>import</span> (
</span></span><span style=display:flex><span>        <span style=color:#a6d189>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6d189>&#34;math&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6d189>&#34;golang.org/x/exp/constraints&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e78284>func</span> compare[T constraints.Ordered](a, b T) <span style=color:#e78284>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#ca9ee6>return</span> !(a &lt; b) <span style=color:#99d1db;font-weight:700>==</span> (a <span style=color:#99d1db;font-weight:700>&gt;=</span> b)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e78284>func</span> <span style=color:#8caaee>main</span>() {
</span></span><span style=display:flex><span>        fmt.<span style=color:#8caaee>Println</span>(<span style=color:#a6d189>&#34;1 and 2:&#34;</span>, <span style=color:#8caaee>compare</span>(<span style=color:#ef9f76>1</span>, <span style=color:#ef9f76>2</span>))
</span></span><span style=display:flex><span>        fmt.<span style=color:#8caaee>Println</span>(<span style=color:#a6d189>&#34;Inf and 0:&#34;</span>, <span style=color:#8caaee>compare</span>(math.<span style=color:#8caaee>Inf</span>(<span style=color:#ef9f76>1</span>), <span style=color:#ef9f76>0</span>))
</span></span><span style=display:flex><span>        fmt.<span style=color:#8caaee>Println</span>(<span style=color:#a6d189>&#34;Inf and Inf:&#34;</span>, <span style=color:#8caaee>compare</span>(math.<span style=color:#8caaee>Inf</span>(<span style=color:#ef9f76>1</span>), math.<span style=color:#8caaee>Inf</span>(<span style=color:#ef9f76>1</span>)))
</span></span><span style=display:flex><span>        fmt.<span style=color:#8caaee>Println</span>(<span style=color:#a6d189>&#34;NaN and 1:&#34;</span>, <span style=color:#8caaee>compare</span>(math.<span style=color:#8caaee>NaN</span>(), <span style=color:#ef9f76>1</span>))
</span></span><span style=display:flex><span>        fmt.<span style=color:#8caaee>Println</span>(<span style=color:#a6d189>&#34;NaN and NaN:&#34;</span>, <span style=color:#8caaee>compare</span>(math.<span style=color:#8caaee>NaN</span>(), math.<span style=color:#8caaee>NaN</span>()))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Playground: <a href=https://go.dev/play/p/iAMjcAgU8pz>https://go.dev/play/p/iAMjcAgU8pz</a></p><h2 id=time-document-hhmmss-formats><a href=https://github.com/golang/go/commit/24b570354caee33d4fb3934ce7ef1cc97fb403fd>time: document hhmmss formats</a></h2><p><code>(time.Time).Format</code> のフォーマット指定文字列、時差の部分について、もともと秒単位まで指定が可能だったにもかかわらずドキュメントに示されていなかったようです。とはいえ秒単位で時差のある地域はないはずなので、これを使う機会はくるのか…… &#x1f914; という感じではありますが。</p><h2 id=crypto-tls-remove-tls10default-godebug-flag><a href=https://github.com/golang/go/commit/f0ee7fda636408b4f04ca3f3b11788f662c90610>crypto/tls: remove tls10default GODEBUG flag</a></h2><p><code>GODEBUG</code> 環境変数で TLS 1.0 を有効にする指定があったのですが、それが無効になったようです。コード中でconfigから有効にする手段はのこっていますが、TLS 1.0は今となっては古くて脆弱……？ですし1.0を使うのはもうやめにしたいですね。</p><h2 id=os-exec-return-error-when-path-lookup-would-use-current-directory><a href=https://github.com/golang/go/commit/3ce203db80cd1f320f0c597123b918c3b3bb0449>os/exec: return error when PATH lookup would use current directory</a></h2><p><code>golang.org/x/sys/execabs</code> と同様に、os/execで実行しようとしたコマンドがカレントディレクトリの実行ファイルだった場合にエラーを返すようになったようです。もともとWindowsでのみの挙動（のはず）ですが、それがUnix環境と同様になった感じですかね。おそらく、こちらでGit LFSの脆弱性としてあげられていたことに対する対処だと思われます。<br>ref; <a href=https://forest.watch.impress.co.jp/docs/news/1404405.html>「Git for Windows」v2.36.0が公開 ～「Git LFS」の脆弱性に対処</a></p><h3 id=revert-os-exec-return-error-when-path-lookup-would-use-current-directory><a href=https://github.com/golang/go/commit/f2b674756b3b684118e4245627d4ed8c07e518e7>Revert &ldquo;os/exec: return error when PATH lookup would use current directory&rdquo;</a></h3><p>と思ったらrevertされてました。どうも <code>x/sys/execabs</code> のテストを壊してしまったようです。</p></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>