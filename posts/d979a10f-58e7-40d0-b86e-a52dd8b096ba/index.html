<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>ox-hugoとnixでブログをビルドする</title>
<meta name=description content="この記事で扱う大きなトピック Emacs org-mode および ox-hugo 皆さんご存知の Emacs には org-mode というツール？が備わっています。
org-mode は markdown などのマークアップ言語の一種である org という形式を扱うものです。この org-mode は Emacs  …"><meta name=keywords content='nix,emacs,org'><meta property="og:url" content="https://warashi.dev/posts/d979a10f-58e7-40d0-b86e-a52dd8b096ba/"><meta property="og:type" content="website"><meta property="og:title" content="ox-hugoとnixでブログをビルドする"><meta property="og:description" content="この記事で扱う大きなトピック Emacs org-mode および ox-hugo 皆さんご存知の Emacs には org-mode というツール？が備わっています。
org-mode は markdown などのマークアップ言語の一種である org という形式を扱うものです。この org-mode は Emacs  …"><meta property="og:image" content="https://warashi.dev/images/tisza.png"><meta property="og:image:secure_url" content="https://warashi.dev/images/tisza.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="ox-hugoとnixでブログをビルドする"><meta name=twitter:description content="この記事で扱う大きなトピック Emacs org-mode および ox-hugo 皆さんご存知の Emacs には org-mode というツール？が備わっています。
org-mode は markdown などのマークアップ言語の一種である org という形式を扱うものです。この org-mode は Emacs  …"><meta property="twitter:domain" content="https://warashi.dev/posts/d979a10f-58e7-40d0-b86e-a52dd8b096ba/"><meta property="twitter:url" content="https://warashi.dev/posts/d979a10f-58e7-40d0-b86e-a52dd8b096ba/"><meta name=twitter:image content="https://warashi.dev/images/tisza.png"><link rel=canonical href=https://warashi.dev/posts/d979a10f-58e7-40d0-b86e-a52dd8b096ba/><link rel=stylesheet type=text/css href=https://warashi.dev/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=https://warashi.dev/css/main.min.css><link id=dark-theme rel=stylesheet href=https://warashi.dev/css/dark.min.css><script src=https://warashi.dev/js/bundle.min.a036ebe92c17ea3f0c07761c2135b82bec6f37c8efb7f49ddad1f28c22fc4769.js integrity="sha256-oDbr6SwX6j8MB3YcITW4K+xvN8jvt/Sd2tHyjCL8R2k="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://warashi.dev/><img src=https://warashi.dev/images/tisza.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://warashi.dev/>404 やる気 Not Found</a></div><div class=nav-links><div class=nav-link><a href=https://warashi.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://warashi.dev/about/ aria-label><span data-feather=smile></span> About</a></div><div class=nav-link><a href=https://warashi.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://times.warashi.dev/ aria-label><span data-feather=hash></span> times-warashi</a></div><div class=nav-link><a href=https://warashi.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://warashi.dev/index.xml aria-label><span data-feather=rss></span> Feed</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://warashi.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://warashi.dev/about/><span data-feather=smile></span> About</a></li><li class=nav-item><a href=https://warashi.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://times.warashi.dev/><span data-feather=hash></span> times-warashi</a></li><li class=nav-item><a href=https://warashi.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://warashi.dev/index.xml><span data-feather=rss></span> Feed</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>ox-hugoとnixでブログをビルドする</h1><small role=doc-subtitle></small><p class=post-date>2024-08-02</p><ul class=post-tags><li class=post-tag><a href=https://warashi.dev/tags/nix>nix</a></li><li class=post-tag><a href=https://warashi.dev/tags/emacs>emacs</a></li><li class=post-tag><a href=https://warashi.dev/tags/org>org</a></li></ul></div><div class=post-content><h2 id=この記事で扱う大きなトピック>この記事で扱う大きなトピック</h2><h3 id=emacs-org-mode-および-ox-hugo>Emacs org-mode および ox-hugo</h3><p>皆さんご存知の Emacs には org-mode というツール？が備わっています。<br>org-mode は markdown などのマークアップ言語の一種である org という形式を扱うものです。この org-mode は Emacs の機能や拡張によって様々な形式で出力することができ、 ox-hugo という拡張を使うと Hugo という静的サイト生成のツールに適した出力ができます。この記事では、その org-mode および ox-hugo を使ってブログサイトを構築する一つの方法を紹介します。</p><h3 id=nix-および-nix-flakes>nix および nix flakes</h3><p>最近僕が普段の環境構築などで利用しているツールに nix というものがあります。<br>nix は言語の名前でもあり、ツールチェインの名前でもあり、 NixOS という名前で Linux のディストリビューションにもなっています。その nix は言語としてはいわゆる関数型言語の一種で、ツールチェインとしては宣言的に、つまり入力さえ一致すれば出力も完全に一致する形で色々なものをビルドすることができるツールです。その nix に flakes という機能があります。これはまだ experimental なのですが、最近はよく使われているみたいなのでこれから破壊的変更が入るというのはあまり考えにくい機能です。僕が方法を知らないだけかもしれませんが、従来の nix では入力を完全に固定することがむつかしいです。そこで、入力の git commit hash や内容のハッシュ値をを lock ファイルに記述する形で再現性をもたせる仕組みがついたのが flakes です。</p><p>この記事で紹介するブログサイトの構築方法では、この flakes を用いてブログサイトのビルド結果に再現性を持たせる試みをしています。</p><h2 id=環境構築>環境構築</h2><h3 id=emacs>Emacs</h3><p>実は、ビルド時には後述する nix flakes の機能で Emacs を用意するため、記事を執筆する時に Emacs を利用しないのであればインストールする必要はありません。つまり、ビルド時に使う Emacs はお好みの方法で用意すれば大丈夫です。</p><h3 id=nix>nix</h3><p>nix のインストールはいくつかの方法がありますが、個人的には <a href=https://github.com/DeterminateSystems/nix-installer>DeterminateSystems/nix-installer</a> によるインストールがおすすめです。こちらのインストーラーを使うと、気に入らなかった時にアンインストールするのが楽なためです。</p><h2 id=org-ファイルの書き方>org ファイルの書き方</h2><p><a href=https://github.com/Warashi/warashi.dev/blob/2f4dc388fc58a6d849f0086cf96afd58b577db46/contents.org>このブログを構築している org ファイル</a>を参考にしてもらえればいいと思います。もっとちゃんと知りたいよーという肩は、<a href=https://ox-hugo.scripter.co/>ox-hugo の公式サイト</a>をご覧ください。</p><h2 id=flake-dot-nix-について>flake.nix について</h2><p><a href=https://github.com/Warashi/warashi.dev/blob/2f4dc388fc58a6d849f0086cf96afd58b577db46/build.nix>このブログを構築しているnixファイル</a>では、ビルドを3段階に分けています。</p><ol><li>ox-hugo による markdown ファイルのビルド</li><li>inputs （大体 flakes の依存関係だと思えばいいです） の一つとして指定したテーマファイルの配置</li><li>hugo による html ファイルのビルド</li></ol><p>リンクしているのは flake.nix から呼び出している build.nix ですが、シェルスクリプトが書いてあるところを読めばざっくり理解できる&mldr;かも？</p><h2 id=実際にブログをビルドしてみる>実際にブログをビルドしてみる</h2><p>この記事を含むブログを実際にビルドしてみましょう。以下のコマンドで <code>result</code> というシンボリックリンクができ、その先に hugo によってビルドされたファイル一式が配置されています。</p><div class=highlight><div style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>git clone https://github.com/Warashi/warashi.dev.git
</span></span><span style=display:flex><span><span style=color:#99d1db>cd</span> warashi.dev
</span></span><span style=display:flex><span>nix build
</span></span></code></pre></td></tr></table></div></div><h2 id=まとめ>まとめ</h2><p>途中から雑になってしまいましたが、ox-hugoとnixを用いてブログをビルドする方法を紹介しました。この方法を使うと中間生成ファイルを気にすることなく、またビルドの再現性についてもあまり気にすることなく org-mode でブログをビルドすることができます。良かったらぜひ試してみてください。</p></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>