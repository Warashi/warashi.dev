<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>Go Commits in This Week at 2022-05-07</title>
<meta name=description content="https://github.com/golang/go に今週あったコミットのうち、僕の目にとまったもをの書いていきます。
os/exec: return error when PATH lookup would use current directory · golang/go@349cc83 · GitHub 先 …"><meta name=keywords content='Go'><meta property="og:url" content="https://warashi.dev/posts/78620327-d47a-46bd-b0b6-dd313dcedeaf/"><meta property="og:type" content="website"><meta property="og:title" content="Go Commits in This Week at 2022-05-07"><meta property="og:description" content="https://github.com/golang/go に今週あったコミットのうち、僕の目にとまったもをの書いていきます。
os/exec: return error when PATH lookup would use current directory · golang/go@349cc83 · GitHub 先 …"><meta property="og:image" content="https://warashi.dev/images/tisza.png"><meta property="og:image:secure_url" content="https://warashi.dev/images/tisza.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Go Commits in This Week at 2022-05-07"><meta name=twitter:description content="https://github.com/golang/go に今週あったコミットのうち、僕の目にとまったもをの書いていきます。
os/exec: return error when PATH lookup would use current directory · golang/go@349cc83 · GitHub 先 …"><meta property="twitter:domain" content="https://warashi.dev/posts/78620327-d47a-46bd-b0b6-dd313dcedeaf/"><meta property="twitter:url" content="https://warashi.dev/posts/78620327-d47a-46bd-b0b6-dd313dcedeaf/"><meta name=twitter:image content="https://warashi.dev/images/tisza.png"><link rel=canonical href=https://warashi.dev/posts/78620327-d47a-46bd-b0b6-dd313dcedeaf/><link rel=stylesheet type=text/css href=https://warashi.dev/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=https://warashi.dev/css/main.min.css><link id=dark-theme rel=stylesheet href=https://warashi.dev/css/dark.min.css><script src=https://warashi.dev/js/bundle.min.a036ebe92c17ea3f0c07761c2135b82bec6f37c8efb7f49ddad1f28c22fc4769.js integrity="sha256-oDbr6SwX6j8MB3YcITW4K+xvN8jvt/Sd2tHyjCL8R2k="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://warashi.dev/><img src=https://warashi.dev/images/tisza.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://warashi.dev/>404 やる気 Not Found</a></div><div class=nav-links><div class=nav-link><a href=https://warashi.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://warashi.dev/about/ aria-label><span data-feather=smile></span> About</a></div><div class=nav-link><a href=https://warashi.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://times.warashi.dev/ aria-label><span data-feather=hash></span> times-warashi</a></div><div class=nav-link><a href=https://warashi.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://warashi.dev/index.xml aria-label><span data-feather=rss></span> Feed</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://warashi.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://warashi.dev/about/><span data-feather=smile></span> About</a></li><li class=nav-item><a href=https://warashi.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://times.warashi.dev/><span data-feather=hash></span> times-warashi</a></li><li class=nav-item><a href=https://warashi.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://warashi.dev/index.xml><span data-feather=rss></span> Feed</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Go Commits in This Week at 2022-05-07</h1><small role=doc-subtitle></small><p class=post-date>2022-05-07</p><ul class=post-tags><li class=post-tag><a href=https://warashi.dev/tags/go>Go</a></li></ul></div><div class=post-content><p><a href=https://github.com/golang/go>https://github.com/golang/go</a> に今週あったコミットのうち、僕の目にとまったもをの書いていきます。</p><h2 id=os-exec-return-error-when-path-lookup-would-use-current-directory-golang-go-349cc83-github><a href=https://github.com/golang/go/commit/349cc83389f71c459b7820b0deecdf81221ba46c>os/exec: return error when PATH lookup would use current directory · golang/go@349cc83 · GitHub</a></h2><p>先週リバートされていたもののリトライのようです。リバートの原因は x/sys/execabs のテストが壊れたからでしたが、対策をしたとのことでした。</p><h2 id=all-reverse-merge-dev-dot-boringcrypto--cdcb4b6--into-master-golang-go-f771edd-github><a href=https://github.com/golang/go/commit/f771edd7f92a47c276d65fbd9619e16a786c6746>all: REVERSE MERGE dev.boringcrypto (cdcb4b6) into master · golang/go@f771edd · GitHub</a></h2><p>別ブランチで開発が進んでいたBoringSSLベースの？暗号まわりの実装が取り込まれたようです。<br><a href=https://github.com/golang/go/commit/dcdcc3844046af0182cd3a94c7bb78c99908020e>[dev.boringcrypto] add README.boringcrypto.md, update VERSION · golang/go@dcdcc38 · GitHub</a> にあるREADMEを見るにもともとmasterに取り込む予定はなかったようですが、取り込まれたみたいですね。</p><h2 id=io-nopcloser-forward-writerto-implementations-if-the-reader-supports-it-golang-go-0537a74-github><a href=https://github.com/golang/go/commit/0537a74b76fcab1398da6699c3ff7411fef8fbe7>io: NopCloser forward WriterTo implementations if the reader supports it · golang/go@0537a74 · GitHub</a></h2><p><code>io.NopCloser</code> に渡した <code>io.Reader</code> が <code>io.WriterTo</code> を実装していた場合に、返ってくる <code>io.ReadCloser</code> も <code>io.WriterTo</code> を実装するようになりました。<br><code>io.WriterTo</code> に高速な実装がある場合に使われるようになったということですね。</p><h2 id=runtime-add-gc-cpu-utilization-limiter-golang-go-01359b4-github><a href=https://github.com/golang/go/commit/01359b46815e63307077dfa03972f40d2e0d94fe>runtime: add GC CPU utilization limiter · golang/go@01359b4 · GitHub</a></h2><p>このコミットには以下の2つの内容が含まれているようです</p><ul><li>GCが使うCPUが最大で50%まで程度になるように制限をかける</li><li>プログラムが使うメモリに制限をかけられるようにするためのfeature flagの導入</li></ul><p>GCが50%もCPUを使うのはまれだとは思いますが、制限がかかるのはうれしいですね。また、メモリ使用量に制限をかけられるのはコンテナでの利用などでうれしいのではないでしょうか。</p><h2 id=runtime-debug-export-setmemorylimit-golang-go-f01c20b-github><a href=https://github.com/golang/go/commit/f01c20bf2ba889e5c9e3565175cc4276f9c11516>runtime/debug: export SetMemoryLimit · golang/go@f01c20b · GitHub</a></h2><p>ひとつ上の項目で導入されたメモリ制限をかける機能を <code>runtime/debug</code> package から扱えるようにするコミットですね。環境変数からセットする必要がなくなるのでうれしいかも？</p><h2 id=runtime-decrease-stw-pause-for-goroutine-profile-golang-go-52bd1c4-github><a href=https://github.com/golang/go/commit/52bd1c4d6cc691aa60c71513695dba03062deb59>runtime: decrease STW pause for goroutine profile · golang/go@52bd1c4 · GitHub</a></h2><p>goroutineのプロファイルを取得するときの処理に改善が行われ、Stop The Worldが減ったようです。おそらく <code>runtime/pprof</code> でプロファイルを取得するときのSTWも減っているはずなので、いままでよりも気軽にプロファイルを取得できるようになりますね。</p><h2 id=cmd-compile-enable-asan-check-for-global-variables-golang-go-f52b4ec-github><a href=https://github.com/golang/go/commit/f52b4ec63d6ce5c4eb9edcb81c3a0661e6f53da0>cmd/compile: enable Asan check for global variables · golang/go@f52b4ec · GitHub</a></h2><p><a href=https://github.com/golang/go/issues/44853>runtime: enable address sanitizer in Go · Issue #44853 · golang/go · GitHub</a> に紐付くコミットで、address sanitizerを使ってグローバル変数へのだめなアクセスを検出するオプションが追加されたようです。</p><h2 id=sync-atomic-add-typed-atomic-values-golang-go-ffe48e0-github><a href=https://github.com/golang/go/commit/ffe48e00adf3078944015186819a1ed5c6aa8bec>sync/atomic: add typed atomic values · golang/go@ffe48e0 · GitHub</a></h2><p><code>sync/atomic</code> packageに以下の型が追加され、atomicであることが型レベルで保証できるようになりました。いままでは <code>go.uber.org/atomic</code> を用いていたところが標準パッケージに（一部）取り込まれた感じでしょうか。</p><ul><li><code>Bool</code></li><li><code>Int32</code></li><li><code>Int64</code></li><li><code>Pointer[T]</code></li><li><code>Uint32</code></li><li><code>Uint64</code></li><li><code>Uintptr</code></li></ul><p>ref; <a href=https://pkg.go.dev/sync/atomic@master>atomic package - sync/atomic - pkg.go.dev</a></p><h2 id=cmd-compile-fold-constants-found-by-prove-golang-go-e1e056f-github><a href=https://github.com/golang/go/commit/e1e056fa6a2f788a15e17d55b7953712053fd760>cmd/compile: fold constants found by prove · golang/go@e1e056f · GitHub</a></h2><p>ちょっとだけ賢い最適化が追加されたようですたとえばこんな感じの最適化が行われるようになるとのこと</p><ul><li>from<div class=highlight><div style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ca9ee6>if</span> x <span style=color:#99d1db;font-weight:700>==</span> <span style=color:#ef9f76>20</span> {
</span></span><span style=display:flex><span>  <span style=color:#ca9ee6>return</span> x <span style=color:#99d1db;font-weight:700>+</span> <span style=color:#ef9f76>30</span> <span style=color:#99d1db;font-weight:700>+</span> z
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></li><li>into<div class=highlight><div style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ca9ee6>if</span> x <span style=color:#99d1db;font-weight:700>==</span> <span style=color:#ef9f76>20</span> {
</span></span><span style=display:flex><span>  <span style=color:#ca9ee6>return</span> <span style=color:#ef9f76>50</span> <span style=color:#99d1db;font-weight:700>+</span> z
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=crypto-x509-disable-signing-with-md5withrsa-golang-go-fdb640b-github><a href=https://github.com/golang/go/commit/fdb640b7a1324c2a4fc579389c4bc287ea90f1db>crypto/x509: disable signing with MD5WithRSA · golang/go@fdb640b · GitHub</a></h2><p>MD5はもう暗号や署名の用途で大丈夫なハッシュではなくなったので、MD5での署名の検証や署名の実行はできなくするようです。危ない物は使わせない、いい方針だと思います。</p></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>