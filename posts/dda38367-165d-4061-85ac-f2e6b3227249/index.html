<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>Go Commits in This Week at 2022-05-14</title>
<meta name=description content="math/big: don&rsquo;t force second arg to Jacobi and Int.ModSqrt to escape · golang/go@831f116 Goはコンパイル時のエスケープ解析で変数のアロケート場所がスタックとヒープに決まります。このコミットはほんのちょっとの変更でスタッ …"><meta name=keywords content='Go'><meta property="og:url" content="https://warashi.dev/posts/dda38367-165d-4061-85ac-f2e6b3227249/"><meta property="og:type" content="website"><meta property="og:title" content="Go Commits in This Week at 2022-05-14"><meta property="og:description" content="math/big: don&rsquo;t force second arg to Jacobi and Int.ModSqrt to escape · golang/go@831f116 Goはコンパイル時のエスケープ解析で変数のアロケート場所がスタックとヒープに決まります。このコミットはほんのちょっとの変更でスタッ …"><meta property="og:image" content="https://warashi.dev/images/tisza.png"><meta property="og:image:secure_url" content="https://warashi.dev/images/tisza.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Go Commits in This Week at 2022-05-14"><meta name=twitter:description content="math/big: don&rsquo;t force second arg to Jacobi and Int.ModSqrt to escape · golang/go@831f116 Goはコンパイル時のエスケープ解析で変数のアロケート場所がスタックとヒープに決まります。このコミットはほんのちょっとの変更でスタッ …"><meta property="twitter:domain" content="https://warashi.dev/posts/dda38367-165d-4061-85ac-f2e6b3227249/"><meta property="twitter:url" content="https://warashi.dev/posts/dda38367-165d-4061-85ac-f2e6b3227249/"><meta name=twitter:image content="https://warashi.dev/images/tisza.png"><link rel=canonical href=https://warashi.dev/posts/dda38367-165d-4061-85ac-f2e6b3227249/><link rel=stylesheet type=text/css href=https://warashi.dev/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=https://warashi.dev/css/main.min.css><link id=dark-theme rel=stylesheet href=https://warashi.dev/css/dark.min.css><script src=https://warashi.dev/js/bundle.min.a036ebe92c17ea3f0c07761c2135b82bec6f37c8efb7f49ddad1f28c22fc4769.js integrity="sha256-oDbr6SwX6j8MB3YcITW4K+xvN8jvt/Sd2tHyjCL8R2k="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://warashi.dev/><img src=https://warashi.dev/images/tisza.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://warashi.dev/>404 やる気 Not Found</a></div><div class=nav-links><div class=nav-link><a href=https://warashi.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://warashi.dev/about/ aria-label><span data-feather=smile></span> About</a></div><div class=nav-link><a href=https://warashi.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://times.warashi.dev/ aria-label><span data-feather=hash></span> times-warashi</a></div><div class=nav-link><a href=https://warashi.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://warashi.dev/index.xml aria-label><span data-feather=rss></span> Feed</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://warashi.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://warashi.dev/about/><span data-feather=smile></span> About</a></li><li class=nav-item><a href=https://warashi.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://times.warashi.dev/><span data-feather=hash></span> times-warashi</a></li><li class=nav-item><a href=https://warashi.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://warashi.dev/index.xml><span data-feather=rss></span> Feed</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Go Commits in This Week at 2022-05-14</h1><small role=doc-subtitle></small><p class=post-date>2022-05-14</p><ul class=post-tags><li class=post-tag><a href=https://warashi.dev/tags/go>Go</a></li></ul></div><div class=post-content><h2 id=math-big-don-t-force-second-arg-to-jacobi-and-int-dot-modsqrt-to-escape-golang-go-831f116><a href=https://github.com/golang/go/commit/831f1168289e65a7ef49942ad8d16cf14af2ef43>math/big: don&rsquo;t force second arg to Jacobi and Int.ModSqrt to escape · golang/go@831f116</a></h2><p>Goはコンパイル時のエスケープ解析で変数のアロケート場所がスタックとヒープに決まります。このコミットはほんのちょっとの変更でスタックにアロケートできたという変更です。普段僕たちが書く時はここまでカリカリのチューニングをする前にもうちょっと他の改善がありそうですが、もし必要になったときは参考にできそうですね。</p><h2 id=archive-zip-permit-zip-files-to-have-prefixes-golang-go-df57592><a href=https://github.com/golang/go/commit/df57592276bc26e2eb4e4ca5e77e4e2e422c7c6b>archive/zip: permit zip files to have prefixes · golang/go@df57592</a></h2><p>自己展開型のzipファイルなどはzipファイルの先頭に自分自身を展開するためのコードが入っています。今までのコードではそれをうまく取り扱えていなかったのを、取り扱えるようにしたという変更です。</p><h2 id=internal-abi-internal-buildcfg-enable-regabi-on-riscv64-by-default-golang-go-53f1312><a href=https://github.com/golang/go/commit/53f13128a7a4c7d16af5ea9ca5f25b56ff9881fe>internal/abi, internal/buildcfg: enable regabi on riscv64 by default · golang/go@53f1312</a></h2><p>Go 1.17から内部のABIを徐々にレジスタベースに変更しているのですが、それをRISC-Vに適用するという変更ですね。</p><h2 id=net-http-close-accepted-connection-golang-go-1ce7fcf><a href=https://github.com/golang/go/commit/1ce7fcf139417d618c2730010ede2afb41664211>net/http: close accepted connection · golang/go@1ce7fcf</a></h2><h3 id=revert-net-http-close-accepted-connection-golang-go-c14ed5b><a href=https://github.com/golang/go/commit/c14ed5b37c6cc387b29a7939cad7c7cbccd59934>Revert &ldquo;net/http: close accepted connection&rdquo; · golang/go@c14ed5b</a></h3><p>net/httpのServerはShutdownを呼ばれたときにコネクションをcloseします。それが一部うまくいっていなかったのを修正した…のですが、graceful shutdownでバグがあったようでrevertされています。</p><h2 id=go-doc-group-play-example-imports-golang-go-59ef3a9><a href=https://github.com/golang/go/commit/59ef3a966b38cb2ac537d1be43f0b8fd2468ea70>go/doc: group play example imports · golang/go@59ef3a9</a></h2><p>Goは ExampleXXX というテストを書くと pkg.go.dev 上で実行可能な例として表示されます。その例を表示する際に、importのグルーピング<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> を壊してしまっていたのを壊さないようにする変更です。</p><h2 id=go-printer-align-expression-list-elements-containing-tabs-golang-go-bf68170><a href=https://github.com/golang/go/commit/bf68170c638e7e69bedcc64fadfd83354fd06c10>go/printer: align expression list elements containing tabs · golang/go@bf68170</a></h2><p>タブ文字がstring literal中などインデント以外で使われているときにgofmtの挙動がおかしかったようです。</p><h2 id=cmd-compile-fix-bad-order-of-evaluation-for-multi-value-f--g---calls-golang-go-7b314d2><a href=https://github.com/golang/go/commit/7b314d27ce5dbc31eed2076e28c0af4ea8c24473>cmd/compile: fix bad order of evaluation for multi-value f()(g()) calls · golang/go@7b314d2</a></h2><p>このような呼び出しが記述されているとき、言語仕様に従うなら <code>f()</code> → <code>t1()</code> → <code>t2()</code> の順に評価されます。これが、現在は違う順序での評価となっていたものを修正するコミットです。</p><div class=highlight><div style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#838ba7" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8caaee>f</span>()(<span style=color:#8caaee>t1</span>(), <span style=color:#8caaee>t2</span>())
</span></span></code></pre></td></tr></table></div></div><h2 id=go-build-replace-ioutil-dot-readdir-with-os-dot-readdir-golang-go-5362827><a href=https://github.com/golang/go/commit/536282763f7357edd81d85993c12fd977fecd378>go/build: replace ioutil.ReadDir with os.ReadDir · golang/go@5362827</a></h2><p><code>ioutil.ReadDir</code> を <code>os.ReadDir</code> に置き換えるPRです。<br>Go1.16からioutilは他のパッケージに同等のものが実装され、新しいコードでのioutilの利用は推奨されていません。<br>Go内部でもまだ利用があった箇所を修正するコミットですが、これだけでパフォーマンスが上がるので積極的に置き換えていきたいですね。</p><h2 id=runtime-measure-stack-usage-start-stacks-larger-if-needed-golang-go-016d755><a href=https://github.com/golang/go/commit/016d7552138077741a9c3fdadc73c0179f5d3ff7>runtime: measure stack usage; start stacks larger if needed · golang/go@016d755</a></h2><p>stackの利用状況を計測して、goroutineを立ち上げるときに必要そうならあらかじめ大きなスタックを確保して起動するという変更です。</p><h2 id=cmd-compile-use-jump-table-on-arm64-golang-go-540f8c2><a href=https://github.com/golang/go/commit/540f8c2b50f5def060244853673ccfc94d2d3e43>cmd/compile: use jump table on ARM64 · golang/go@540f8c2</a></h2><p>ARM64 において、switch-caseでジャンプテーブルが使われるようになっています。これによってパフォーマンス改善が行われています。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>importを空行で分割して複数のグループがあるように見せること。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>